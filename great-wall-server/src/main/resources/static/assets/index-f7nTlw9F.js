import{z as s,i as e,A as r,a,u as n,b as i,j as t,C as l,c as o,d as c,e as d,f as m,F as x,g as u,h as f,k as j,l as h,I as g,m as p,B as w,t as y}from"./index-CS3RdbcM.js";import{P as b,H as N,g as q,u as A}from"./useApiRequest-BZsjsfZc.js";const E=s.object({username:s.string({required_error:"不可以为空"}).min(2,{message:"不能少于2个字符"}).max(20,{message:"不能超过20个字符"}),password:s.string({required_error:"不可以为空"}).max(50,{message:"不能超过50个字符"})});function v(s){return b("/api/login",{body:s})}function S(){const s=n(),b=i({resolver:y(E)}),{runAsync:S,loading:_}=A(v,{manual:!0,noticeError:!1}),k=function(s,n){const i=!!e(n)||n,{setError:t}=s;return async s=>{try{return await s()}catch(e){if(e instanceof N){if(422===e.status){const s=e.body.fields;for(let e in s){const r=s[e];if(r.length>0){const s=r[0];t(e,{type:s.code,message:s.message})}}}else if(i){let s=q(e);r.warning(s,{position:"top-right"})}}else if(i){let s;if(e instanceof Error){const r=e.message;s="未知的异常"+(a(r)?"!":`: ${r}`)}else s="未知的异常!";r.warning(s,{position:"top-right"})}throw e}}}(b);return t.jsx("div",{className:"w-full h-screen flex items-center justify-center px-4",children:t.jsxs(l,{className:"w-full max-w-sm",children:[t.jsxs(o,{children:[t.jsx(c,{className:"text-2xl",children:"登录"}),t.jsx(d,{children:"欢迎登录 Great Wall"})]}),t.jsx(m,{className:"grid gap-4",children:t.jsx(x,{...b,children:t.jsxs("form",{onSubmit:b.handleSubmit((async function(e){await k((()=>S(e))),s("/")})),className:"space-y-8",children:[t.jsx(u,{control:b.control,name:"username",render:({field:s})=>t.jsxs(f,{children:[t.jsx(j,{children:"账号"}),t.jsx(h,{children:t.jsx(g,{...s})}),t.jsx(p,{})]})}),t.jsx(u,{control:b.control,name:"password",render:({field:s})=>t.jsxs(f,{children:[t.jsx(j,{children:"密码"}),t.jsx(h,{children:t.jsx(g,{...s,type:"password"})}),t.jsx(p,{})]})}),t.jsx(w,{type:"submit",loading:_,className:"w-full",children:"登录"})]})})})]})})}export{S as default};
