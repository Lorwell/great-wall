import{n as e,W as a,j as l,X as t,Y as s,Z as r,a0 as n,a1 as i,u as o}from"./index-C1QDsp8W.js";import{D as c,R as d,d as u,c as p,a as m,b as x}from"./data-table-row-actions-CqGrLy8T.js";import{u as h}from"./useApiRequest-BY4n_wMi.js";import{a as v,s as f}from"./index-52MlNcA9.js";import{L as j}from"./layout-panel-left-BxVXRJCz.js";import"./popover-Mp_Phhtu.js";import"./separator-B7eVtzgc.js";import"./checkbox-CSgsbLFl.js";
/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=e("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),w=e("ShieldBan",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m4.243 5.21 14.39 12.472",key:"1c9a7c"}]]),g=e=>{const{row:t,column:s,cell:r,table:n,onView:i,onOnline:o,onOffline:u,onEdit:p}=e,m={row:t,column:s,cell:r,table:n},x=t.getValue("status"),h=[{key:"view",label:"查看",icon:d,onClick:()=>null==i?void 0:i(m)},{key:"edit",label:"编辑",icon:b,onClick:()=>null==p?void 0:p(m)}];return a.ONLINE===x?h.push({key:"offline",label:"下线",icon:w,onClick:()=>null==u?void 0:u(m)}):a.OFFLINE===x&&h.push({key:"online",label:"上线",icon:w,onClick:()=>null==o?void 0:o(m)}),l.jsx(c,{row:t,options:h})};
/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function N(e){switch(e){case t.AND:return"与";case t.OR:return"或";default:return""}}function y(e){const{predicates:a}=e;return l.jsx("div",{className:"w-full",children:l.jsxs(s,{children:[l.jsx(r,{children:l.jsx(n,{variant:"secondary",className:"cursor-pointer",children:a.length})}),l.jsx(i,{children:l.jsx("div",{className:"table table-auto border-separate border-spacing-1",children:a.map(((e,a)=>l.jsx(O,{value:e,first:0===a,viewOperator:!0},a)))})})]})})}function O({value:e,first:a=!1,viewOperator:t=!1}){const{predicate:s,operator:r}=e,{type:n}=s;switch(n){case"Host":return l.jsx(C,{value:s,first:a,operator:r,viewOperator:t});case"Cookie":return l.jsx(k,{kvType:"Cookie",value:s,first:a,operator:r,viewOperator:t});case"Header":return l.jsx(k,{kvType:"Header",value:s,first:a,operator:r,viewOperator:t});case"Query":return l.jsx(k,{kvType:"Query",value:s,first:a,operator:r,viewOperator:t});case"Method":return l.jsx(I,{value:s,first:a,operator:r,viewOperator:t});case"Path":return l.jsx(V,{value:s,first:a,operator:r,viewOperator:t});case"RemoteAddr":return l.jsx(z,{value:s,first:a,operator:r,viewOperator:t})}throw new Error(`未知的类型 ${n}`)}function k({kvType:e,value:a,first:t,operator:s,viewOperator:r=!1}){const{name:n,regexp:i}=a;return l.jsxs("div",{className:"table-row",children:[r&&!!s&&l.jsx("div",{className:"table-cell text-left pr-1",children:t?"":N(s)}),l.jsxs("div",{className:"table-cell text-right",children:[e," 匹配规则："]}),l.jsxs("div",{className:"table-cell text-left truncate",children:[n,"=",i]})]})}function C({value:e,first:a,operator:t,viewOperator:s=!1}){const{patterns:r}=e;return l.jsxs("div",{className:"table-row",children:[s&&!!t&&l.jsx("div",{className:"table-cell text-left pr-1",children:a?"":N(t)}),l.jsx("div",{className:"table-cell text-right",children:"Host 匹配规则："}),l.jsx("div",{className:"table-cell text-left truncate",children:r.map(((e,a)=>l.jsxs("span",{children:[e,a+1<r.length&&", "]},a)))})]})}function I({value:e,first:a,operator:t,viewOperator:s=!1}){const{methods:r}=e;return l.jsxs("div",{className:"table-row",children:[s&&!!t&&l.jsx("div",{className:"table-cell text-left pr-1",children:a?"":N(t)}),l.jsx("div",{className:"table-cell text-right",children:"Method 匹配规则："}),l.jsx("div",{className:"table-cell text-left truncate",children:r.map(((e,a)=>l.jsxs("span",{children:[e,a+1<r.length&&", "]},a)))})]})}function V({value:e,first:a,operator:t,viewOperator:s=!1}){const{patterns:r}=e;return l.jsxs("div",{className:"table-row",children:[s&&!!t&&l.jsx("div",{className:"table-cell text-left pr-1",children:a?"":N(t)}),l.jsx("div",{className:"table-cell text-right",children:"Path 匹配规则："}),l.jsx("div",{className:"table-cell text-left truncate",children:r.map(((e,a)=>l.jsxs("span",{children:[e,a+1<r.length&&", "]},a)))})]})}function z({value:e,first:a,operator:t,viewOperator:s=!1}){const{sources:r}=e;return l.jsxs("div",{className:"table-row",children:[s&&!!t&&l.jsx("div",{className:"table-cell text-left pr-1",children:a?"":N(t)}),l.jsx("div",{className:"table-cell text-right",children:"Path 匹配规则："}),l.jsx("div",{className:"table-cell text-left truncate",children:r.map(((e,a)=>l.jsxs("span",{children:[e,a+1<r.length&&", "]},a)))})]})}const Y=({event:e})=>[u(),p({columnId:"name",label:"名称",size:120,enableSorting:!1,cell:({getValue:e})=>e()}),p({columnId:"predicates",label:"路由条件",size:80,enableSorting:!1,cell:({getValue:e})=>{const a=e();return l.jsx(y,{predicates:a})}}),p({columnId:"targetConfig",label:"目标地址",size:200,enableSorting:!1,cell:({getValue:e})=>{const{urls:a}=e();return l.jsxs("div",{className:"w-full flex gap-1",children:[l.jsx("div",{className:"truncate",style:{width:"calc(100% - 25px)"},children:a.map((e=>e.url)).join(", ")}),l.jsxs(s,{children:[l.jsx(r,{children:l.jsx(n,{variant:"secondary",className:"cursor-pointer",children:a.length})}),l.jsx(i,{children:l.jsx("div",{className:"flex flex-col gap-1",children:a.map(((e,a)=>l.jsxs("span",{children:[e.url,"  -  权重：",e.weight]},a)))})})]})]})}}),p({columnId:"priority",label:"优先级",size:100,cell:({getValue:e})=>l.jsx("div",{className:"p-4",children:e()})}),p({columnId:"status",label:"状态",size:80,cell:({getValue:e})=>e()}),p({columnId:"createTime",label:"创建时间",size:150,cell:({getValue:e})=>m(e()).format("YYYY-MM-DD HH:mm:ss")}),p({columnId:"lastUpdateTime",label:"最后修改时间",size:150,cell:({getValue:e})=>m(e()).format("YYYY-MM-DD HH:mm:ss")}),{id:"_actions",size:50,cell:({cell:a,column:t,row:s,table:r})=>l.jsx(g,{...e,row:s,cell:a,column:t,table:r})}];function H(){const e=o(),{data:t,loading:s,run:r}=h(v),{loading:n,runAsync:i}=h(f,{manual:!0});return l.jsx("div",{className:"w-full h-full",children:l.jsx(x,{data:(null==t?void 0:t.records)||[],rowCount:null==t?void 0:t.page.total,searchColumnId:"name",manual:!1,loading:s||n,columns:Y({event:{onView:function(a){const l=a.row.original.id;e(`/manage/app-routes/${l}/preview`)},onEdit:function(a){const l=a.row.original.id;e(`/manage/app-routes/${l}`)},onOffline:async function(e){const l=e.row.original.id;await i(l,a.OFFLINE),r()},onOnline:async function(e){const l=e.row.original.id;await i(l,a.ONLINE),r()}}}),plusOptions:[{label:"新建应用路由",icon:j,onClick:()=>e("/manage/app-routes/add/base-info")}]})})}export{H as default};
